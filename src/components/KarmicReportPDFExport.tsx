
import React from 'react';
import { Button } from "@/components/ui/button";
import { Download, FileText } from "lucide-react";
import jsPDF from 'jspdf';
import { useToast } from "@/hooks/use-toast";

interface KarmicReportPDFExportProps {
  language: 'hi' | 'en';
  reportData?: any;
}

const KarmicReportPDFExport: React.FC<KarmicReportPDFExportProps> = ({ language, reportData }) => {
  const { toast } = useToast();

  const generatePDF = () => {
    try {
      const doc = new jsPDF();
      
      // Set font
      doc.setFont('helvetica');
      
      // Colors
      const primaryColor = [90, 75, 218]; // #5A4BDA
      const highlightColor = [255, 215, 0]; // #FFD700
      const textColor = [31, 41, 55]; // #1F2937
      
      let yPosition = 20;
      
      // Header
      doc.setFontSize(24);
      doc.setTextColor(...primaryColor);
      doc.text('ЁЯкФ ' + (language === 'hi' ? 'рдЖрдкрдХреА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХрд░рд┐рдпрд░ рдХрд░реНрдо рд░рд┐рдкреЛрд░реНрдЯ' : 'Your Personalized Career Karma Report'), 20, yPosition);
      
      yPosition += 10;
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text(language === 'hi' ? 'рдЖрдпреБ рдПрд╕реНрдЯреНрд░реЛ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди ┬╖ рдЬреНрдпреЛрддрд┐рд╖ + NLP + рдЬреЗрдорд┐рдиреА AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд' : 'Generated by Ayu Astro ┬╖ Powered by Jyotish + NLP + Gemini AI', 20, yPosition);
      
      yPosition += 15;
      doc.setDrawColor(...primaryColor);
      doc.line(20, yPosition, 190, yPosition);
      yPosition += 15;
      
      // Section 1: Career Signature
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '1. рдЖрдкрдХрд╛ рдХрд░реНрдорд┐рдХ рдХрд░рд┐рдпрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░' : '1. Your Karmic Career Signature', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const signatureData = [
        [language === 'hi' ? 'рд▓рдЧреНрди' : 'Lagna', 'Capricorn тАУ ' + (language === 'hi' ? 'рдирд┐рд░реНрдорд╛рддрд╛' : 'The Builder')],
        [language === 'hi' ? 'рдЪрдВрджреНрд░ рдирдХреНрд╖рддреНрд░' : 'Moon Nakshatra', 'Magha тАУ ' + (language === 'hi' ? 'рд╡рд┐рд░рд╛рд╕рдд рдЪрд╛рд╣рддрд╛ рд╣реИ' : 'Seeks legacy')],
        [language === 'hi' ? '10рд╡реЗрдВ рдШрд░ рдХрд╛ рдЧреНрд░рд╣' : '10th House Planet', 'Mars тАУ ' + (language === 'hi' ? 'рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди, рдкреНрд░реЗрд░рдгрд╛' : 'Execution, drive')],
        [language === 'hi' ? 'D10 рд╕рд╛рд░рд╛рдВрд╢' : 'D10 Summary', 'Saturn тАУ ' + (language === 'hi' ? 'рд╕рдВрд░рдЪрдирд╛, рдзреАрдореА рдЙрдиреНрдирддрд┐' : 'Structure, slow rise')]
      ];
      
      signatureData.forEach(([key, value]) => {
        doc.text(`${key}: ${value}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 2: Career Blocks
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '2. рдХрд░рд┐рдпрд░ рдХрд░реНрдо рдмрд╛рдзрд╛рдПрдВ' : '2. Career Karma Blocks', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const blocks = [
        'SaturnтАУMoon Dasha тЖТ ' + (language === 'hi' ? 'рднрд╛рд╡рдирд╛рддреНрдордХ рджрдорди + рд╡рд┐рд▓рдВрдмрд┐рдд рдкреБрд░рд╕реНрдХрд╛рд░' : 'Emotional suppression + delayed rewards'),
        '10th Lord in 8th тЖТ ' + (language === 'hi' ? 'рдЫреБрдкреЗ рд╣реБрдП рд╢рдХреНрддрд┐ рд╕рдВрдШрд░реНрд╖' : 'Hidden power struggles'),
        'Rahu in 6th тЖТ ' + (language === 'hi' ? 'рдЕрдзрд┐рдХ рдХрд╛рдо рдХрд╛ рдЪрдХреНрд░ + рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рддрд┐рд░реЛрдз' : 'Overwork loop + authority resistance')
      ];
      
      blocks.forEach(block => {
        doc.text(`тАв ${block}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 3: Ideal Career Roles
      if (yPosition > 250) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '3. рдЖрджрд░реНрд╢ рдХрд░рд┐рдпрд░ рдкрде' : '3. Ideal Career Path', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const careers = [
        [language === 'hi' ? 'рдкреНрд░реЛрдбрдХреНрдЯ рдореИрдиреЗрдЬрд░' : 'Product Manager', language === 'hi' ? 'рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗрдВрджреНрд░рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдмрдирд╛рдирд╛' : 'Build systems with user focus'],
        [language === 'hi' ? 'рдиреАрддрд┐ рдбрд┐рдЬрд╛рдЗрдирд░' : 'Policy Designer', language === 'hi' ? 'рд░рдгрдиреАрддрд┐рдХ рдзрд░реНрдо-рд╕рдВрд░реЗрдЦрд┐рдд рдХрд░рд┐рдпрд░' : 'Strategic dharma-aligned career'],
        [language === 'hi' ? 'UX рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЯ' : 'UX Architect', language === 'hi' ? 'рдорди-рдЕрдиреБрдХреВрд▓ рд╕рд┐рд╕реНрдЯрдо рдбрд┐рдЬрд╛рдЗрди' : 'Design mind-friendly systems']
      ];
      
      careers.forEach(([role, why]) => {
        doc.text(`тАв ${role}: ${why}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 4: Timeline
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '4. рдЖрдкрдХреА рдХрд░рд┐рдпрд░ рд╕рдордпрд░реЗрдЦрд╛' : '4. Your Career Timeline', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      doc.text('2025-2026: Saturn Phase - ' + (language === 'hi' ? 'рдирд┐рд░реНрдорд╛рдг + рдкреНрд░рддреАрдХреНрд╖рд╛' : 'Build + Wait'), 25, yPosition);
      yPosition += 6;
      doc.text('2026-2028: Mercury Phase - ' + (language === 'hi' ? 'рд░рдгрдиреАрддрд┐рдХ рдЫрд▓рд╛рдВрдЧ' : 'Strategic Leap'), 25, yPosition);
      yPosition += 6;
      doc.text('2028+: ' + (language === 'hi' ? 'рдирдпрд╛ рдЪрд░рдг' : 'New Phase'), 25, yPosition);
      yPosition += 15;
      
      // Section 5: Weekly Actions
      if (yPosition > 230) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '5. рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдХрд░реНрдо рдХрд╛рд░реНрдп' : '5. Weekly Karma Actions', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const weeklyActions = [
        language === 'hi' ? 'рд╕рдкреНрддрд╛рд╣ 1: рдПрдХ рдордЬрджреВрд░ рдпрд╛ рдбреНрд░рд╛рдЗрд╡рд░ рдХреА рдмрд┐рдирд╛ рдЕрдкреЗрдХреНрд╖рд╛ рдХреЗ рдорджрдж рдХрд░реЗрдВ (рд╢рдирд┐)' : 'Week 1: Help a laborer or driver without expecting anything (Saturn)',
        language === 'hi' ? 'рд╕рдкреНрддрд╛рд╣ 2: рдЕрдкрдиреЗ рд╕рдмрд╕реЗ рдмрдбрд╝реЗ рднрд╛рд╡рдирд╛рддреНрдордХ рдШрд╛рд╡ рдХреЛ рдбрд╛рдпрд░реА рдореЗрдВ рд▓рд┐рдЦреЗрдВ (рдЪрдВрджреНрд░)' : 'Week 2: Journal your biggest emotional wound (Moon)',
        language === 'hi' ? 'рд╕рдкреНрддрд╛рд╣ 3: рдХрд┐рд╕реА рдХреЛ рдЕрдкрдирд╛ рдорд╣рд╛рд░рдд рд╣рд╛рд╕рд┐рд▓ рдХреМрд╢рд▓ рд╕рд┐рдЦрд╛рдПрдВ (рдмреГрд╣рд╕реНрдкрддрд┐)' : 'Week 3: Teach someone a skill you have mastered (Jupiter)',
        language === 'hi' ? 'рд╕рдкреНрддрд╛рд╣ 4: рдЧрдкрд╢рдк рдпрд╛ рдСрдлрд┐рд╕ рд░рд╛рдЬрдиреАрддрд┐ рд╕реЗ рдмрдЪреЗрдВ (рд░рд╛рд╣реБ)' : 'Week 4: Avoid gossip or office politics (Rahu)'
      ];
      
      weeklyActions.forEach(action => {
        doc.text(`тАв ${action}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 6: Remedies
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '6. рдХрд░реНрдорд┐рдХ рдЙрдкрдЪрд╛рд░' : '6. Karmic Remedies', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const remedies = [
        language === 'hi' ? 'ЁЯкФ рд╢рдирд┐: рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдмреБрдЬреБрд░реНрдЧ рдордЬрджреВрд░реЛрдВ рдХреА рд╕реЗрд╡рд╛ рдХрд░реЗрдВ, рдХрд╛рд▓рд╛ рддрд┐рд▓ рджрд╛рди рдХрд░реЗрдВ' : 'ЁЯкФ Saturn: Serve elder laborers weekly, donate black sesame',
        language === 'hi' ? 'ЁЯкФ рд░рд╛рд╣реБ: рд░реЛрдЬ 5 рдорд┐рдирдЯ рд╕рд╛рдВрд╕ рдкрд░ рдзреНрдпрд╛рди рджреЗрдВ, рдЕрдорд╛рд╡рд╕реНрдпрд╛ рдкрд░ рдбрд┐рдЯреЙрдХреНрд╕ рдХрд░реЗрдВ' : 'ЁЯкФ Rahu: Do 5 minutes of breath focus daily, detox on new moon',
        language === 'hi' ? 'ЁЯкФ рдЪрдВрджреНрд░: рдкреВрд░реНрдгрд┐рдорд╛ рдЬрд▓ рдЪрд┐рдХрд┐рддреНрд╕рд╛, рдЪрд╛рдВрджреА рдкрд╣рдиреЗрдВ, рд╕рдЪ рдмреЛрд▓реЗрдВ' : 'ЁЯкФ Moon: Full moon water therapy, wear silver, speak your truth'
      ];
      
      remedies.forEach(remedy => {
        doc.text(remedy, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 15;
      
      // Coach Message
      if (yPosition > 220) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '7. рдЖрдкрдХреЗ рдХрд░реНрдорд┐рдХ рдХреЛрдЪ рдХрд╛ рд╕рдВрджреЗрд╢' : '7. Message from Your Karmic Coach', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(12);
      doc.setTextColor(...textColor);
      const coachMessage = language === 'hi' ? 
        'рдЖрдк рдЦреЛрдП рдирд╣реАрдВ рд╣реИрдВред рдЖрдк рдкреБрд░рд╛рдиреЗ рдХрд░реНрдо рдФрд░ рдирдП рдзрд░реНрдо рдХреЗ рдмреАрдЪ рд╡рд┐рд░рд╛рдо рдореЗрдВ рд╣реИрдВред рдЗрд╕реЗ рдЖрдкрдХреЛ рд╕рд┐рдЦрд╛рдиреЗ рджреЗрдВ тАФ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рдХрд░рдиреЗ рджреЗрдВред' :
        'You\'re not lost. You\'re in the pause between past karma and new dharma. Let it teach you тАФ not define you.';
      
      const splitMessage = doc.splitTextToSize(`"${coachMessage}"`, 150);
      doc.text(splitMessage, 25, yPosition);
      yPosition += splitMessage.length * 6 + 15;
      
      // Footer
      if (yPosition > 250) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(10);
      doc.setTextColor(100, 100, 100);
      doc.text(language === 'hi' ? 'рдЖрдпреБ рдПрд╕реНрдЯреНрд░реЛ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди ┬╖ рд╕реНрд╡рд┐рд╕ рдПрдлреЗрдореЗрд░рд┐рд╕ + рдЬреЗрдорд┐рдиреА AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд' : 'Generated by Ayu Astro ┬╖ Powered by Swiss Ephemeris + Gemini AI', 20, yPosition);
      yPosition += 6;
      doc.text(language === 'hi' ? 'рдЖрдкрдХрд╛ рдХрд░реНрдорд┐рдХ рдкрде рдкрд╡рд┐рддреНрд░ рд╣реИред рдЗрд╕реЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рджреЗрдВ, рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рди рдХрд░реЗрдВред' : 'Your karmic path is sacred. Let it guide, not restrict you.', 20, yPosition);
      
      // Save the PDF
      const fileName = `karmic-career-report-${new Date().toISOString().split('T')[0]}.pdf`;
      doc.save(fileName);
      
      toast({
        title: language === 'hi' ? "PDF рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛ рдЧрдпрд╛" : "PDF Downloaded",
        description: language === 'hi' ? "рдЖрдкрдХреА рдХрд░реНрдорд┐рдХ рд░рд┐рдкреЛрд░реНрдЯ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛ рдЧрдИ" : "Your karmic report has been downloaded successfully"
      });
      
    } catch (error) {
      console.error('Error generating PDF:', error);
      toast({
        title: language === 'hi' ? "рддреНрд░реБрдЯрд┐" : "Error",
        description: language === 'hi' ? "PDF рдмрдирд╛рдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐ рд╣реБрдИ" : "Error generating PDF",
        variant: "destructive"
      });
    }
  };

  return (
    <Button onClick={generatePDF} className="w-full sm:w-auto bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white">
      <Download className="w-4 h-4 mr-2" />
      {language === 'hi' ? 'ЁЯУе PDF рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ' : 'ЁЯУе Download PDF'}
    </Button>
  );
};

export default KarmicReportPDFExport;

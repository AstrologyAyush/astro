
import React from 'react';
import { Button } from "@/components/ui/button";
import { Download } from "lucide-react";
import jsPDF from 'jspdf';
import { useToast } from "@/hooks/use-toast";

interface KarmicReportPDFExportProps {
  language: 'hi' | 'en';
  reportData: any;
}

const KarmicReportPDFExport: React.FC<KarmicReportPDFExportProps> = ({ language, reportData }) => {
  const { toast } = useToast();

  const generatePDF = () => {
    try {
      const doc = new jsPDF();
      
      // Set font
      doc.setFont('helvetica');
      
      // Colors
      const primaryColor = [90, 75, 218]; // #5A4BDA
      const textColor = [31, 41, 55]; // #1F2937
      
      let yPosition = 20;
      
      // Header
      doc.setFontSize(24);
      doc.setTextColor(90, 75, 218);
      doc.text('ЁЯкФ ' + (language === 'hi' ? 'рдЖрдкрдХреА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХрд░рд┐рдпрд░ рдХрд░реНрдо рд░рд┐рдкреЛрд░реНрдЯ' : 'Your Personalized Career Karma Report'), 20, yPosition);
      
      yPosition += 10;
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text(language === 'hi' ? 'рдЖрдпреБ рдПрд╕реНрдЯреНрд░реЛ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди ┬╖ рдЬреНрдпреЛрддрд┐рд╖ + NLP + рдЬреЗрдорд┐рдиреА AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд' : 'Generated by Ayu Astro ┬╖ Powered by Jyotish + NLP + Gemini AI', 20, yPosition);
      
      yPosition += 15;
      doc.setDrawColor(90, 75, 218);
      doc.line(20, yPosition, 190, yPosition);
      yPosition += 15;
      
      // Section 1: Career Signature (Using actual data)
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '1. рдЖрдкрдХрд╛ рдХрд░реНрдорд┐рдХ рдХрд░рд┐рдпрд░ рд╣рд╕реНрддрд╛рдХреНрд╖рд░' : '1. Your Karmic Career Signature', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(31, 41, 55);
      
      const signatureData = [
        [language === 'hi' ? 'рд▓рдЧреНрди' : 'Lagna', reportData?.lagna || 'Unknown'],
        [language === 'hi' ? 'рдЪрдВрджреНрд░ рдирдХреНрд╖рддреНрд░' : 'Moon Nakshatra', reportData?.moonNakshatra || 'Unknown'],
        [language === 'hi' ? '10рд╡рд╛рдВ рдШрд░' : '10th House', reportData?.tenthHouseLord || 'Unknown'],
        [language === 'hi' ? 'рд╡рд░реНрддрдорд╛рди рджрд╢рд╛' : 'Current Dasha', reportData?.currentDasha || 'Unknown']
      ];
      
      signatureData.forEach(([key, value]) => {
        doc.text(`${key}: ${value}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 2: Career Blocks (Using actual data)
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '2. рдХрд░рд┐рдпрд░ рдХрд░реНрдо рдмрд╛рдзрд╛рдПрдВ' : '2. Career Karma Blocks', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(31, 41, 55);
      
      if (reportData?.careerBlocks && reportData.careerBlocks.length > 0) {
        reportData.careerBlocks.forEach((block: string) => {
          const wrappedText = doc.splitTextToSize(`тАв ${block}`, 170);
          doc.text(wrappedText, 25, yPosition);
          yPosition += wrappedText.length * 6;
        });
      } else {
        doc.text('тАв ' + (language === 'hi' ? 'рдХреЛрдИ рдкреНрд░рдореБрдЦ рдмрд╛рдзрд╛ рдирд╣реАрдВ рдорд┐рд▓реА' : 'No major blocks detected'), 25, yPosition);
        yPosition += 6;
      }
      
      yPosition += 10;
      
      // Section 3: Ideal Career Roles (Using actual data)
      if (yPosition > 250) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '3. рдЖрджрд░реНрд╢ рдХрд░рд┐рдпрд░ рдкрде' : '3. Ideal Career Path', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(31, 41, 55);
      
      if (reportData?.idealCareers && reportData.idealCareers.length > 0) {
        reportData.idealCareers.forEach((career: any) => {
          doc.text(`тАв ${career.role}: ${career.reason}`, 25, yPosition);
          yPosition += 6;
        });
      }
      
      yPosition += 10;
      
      // Section 4: Timeline (Using actual data)
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '4. рдЖрдкрдХреА рдХрд░рд┐рдпрд░ рд╕рдордпрд░реЗрдЦрд╛' : '4. Your Career Timeline', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(31, 41, 55);
      if (reportData?.timeline) {
        const timelineText = doc.splitTextToSize(reportData.timeline, 170);
        doc.text(timelineText, 25, yPosition);
        yPosition += timelineText.length * 6 + 15;
      }
      
      // Section 5: Weekly Actions (Using actual data)
      if (yPosition > 230) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '5. рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рдХрд░реНрдо рдХрд╛рд░реНрдп' : '5. Weekly Karma Actions', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(31, 41, 55);
      
      if (reportData?.weeklyActions && reportData.weeklyActions.length > 0) {
        reportData.weeklyActions.forEach((action: any) => {
          const actionText = doc.splitTextToSize(`рд╕рдкреНрддрд╛рд╣ ${action.week}: ${action.action} (${action.planet})`, 170);
          doc.text(actionText, 25, yPosition);
          yPosition += actionText.length * 6;
        });
      }
      
      yPosition += 10;
      
      // Section 6: Remedies (Using actual data)
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '6. рдХрд░реНрдорд┐рдХ рдЙрдкрдЪрд╛рд░' : '6. Karmic Remedies', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(31, 41, 55);
      
      if (reportData?.remedies && reportData.remedies.length > 0) {
        reportData.remedies.forEach((remedy: string) => {
          const remedyText = doc.splitTextToSize(remedy, 170);
          doc.text(remedyText, 25, yPosition);
          yPosition += remedyText.length * 6;
        });
      }
      
      yPosition += 15;
      
      // Coach Message (Using actual data)
      if (yPosition > 220) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(90, 75, 218);
      doc.text(language === 'hi' ? '7. рдЖрдкрдХреЗ рдХрд░реНрдорд┐рдХ рдХреЛрдЪ рдХрд╛ рд╕рдВрджреЗрд╢' : '7. Message from Your Karmic Coach', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(12);
      doc.setTextColor(31, 41, 55);
      
      if (reportData?.coachMessage) {
        const splitMessage = doc.splitTextToSize(`"${reportData.coachMessage}"`, 150);
        doc.text(splitMessage, 25, yPosition);
        yPosition += splitMessage.length * 6 + 15;
      }
      
      // Footer
      if (yPosition > 250) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(10);
      doc.setTextColor(100, 100, 100);
      doc.text(language === 'hi' ? 'рдЖрдпреБ рдПрд╕реНрдЯреНрд░реЛ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди ┬╖ рд╕реНрд╡рд┐рд╕ рдПрдлреЗрдореЗрд░рд┐рд╕ + рдЬреЗрдорд┐рдиреА AI рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд' : 'Generated by Ayu Astro ┬╖ Powered by Swiss Ephemeris + Gemini AI', 20, yPosition);
      yPosition += 6;
      doc.text(language === 'hi' ? 'рдЖрдкрдХрд╛ рдХрд░реНрдорд┐рдХ рдкрде рдкрд╡рд┐рддреНрд░ рд╣реИред рдЗрд╕реЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рджреЗрдВ, рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рди рдХрд░реЗрдВред' : 'Your karmic path is sacred. Let it guide, not restrict you.', 20, yPosition);
      
      // Save the PDF
      const fileName = `personalized-karmic-career-report-${new Date().toISOString().split('T')[0]}.pdf`;
      doc.save(fileName);
      
      toast({
        title: language === 'hi' ? "PDF рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛ рдЧрдпрд╛" : "PDF Downloaded",
        description: language === 'hi' ? "рдЖрдкрдХреА рд╡реНрдпрдХреНрддрд┐рдЧрдд рдХрд░реНрдорд┐рдХ рд░рд┐рдкреЛрд░реНрдЯ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛ рдЧрдИ" : "Your personalized karmic report has been downloaded successfully"
      });
      
    } catch (error) {
      console.error('Error generating PDF:', error);
      toast({
        title: language === 'hi' ? "рддреНрд░реБрдЯрд┐" : "Error",
        description: language === 'hi' ? "PDF рдмрдирд╛рдиреЗ рдореЗрдВ рддреНрд░реБрдЯрд┐ рд╣реБрдИ" : "Error generating PDF",
        variant: "destructive"
      });
    }
  };

  return (
    <Button onClick={generatePDF} className="w-full sm:w-auto bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white">
      <Download className="w-4 h-4 mr-2" />
      {language === 'hi' ? 'ЁЯУе PDF рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ' : 'ЁЯУе Download PDF'}
    </Button>
  );
};

export default KarmicReportPDFExport;

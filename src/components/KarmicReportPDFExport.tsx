
import React from 'react';
import { Button } from "@/components/ui/button";
import { Download, FileText } from "lucide-react";
import jsPDF from 'jspdf';
import { useToast } from "@/hooks/use-toast";

interface KarmicReportPDFExportProps {
  language: 'hi' | 'en';
  reportData?: any;
}

const KarmicReportPDFExport: React.FC<KarmicReportPDFExportProps> = ({ language, reportData }) => {
  const { toast } = useToast();

  const generatePDF = () => {
    try {
      const doc = new jsPDF();
      
      // Set font
      doc.setFont('helvetica');
      
      // Colors
      const primaryColor = [90, 75, 218]; // #5A4BDA
      const highlightColor = [255, 215, 0]; // #FFD700
      const textColor = [31, 41, 55]; // #1F2937
      
      let yPosition = 20;
      
      // Header
      doc.setFontSize(24);
      doc.setTextColor(...primaryColor);
      doc.text('ü™î ' + (language === 'hi' ? '‡§Ü‡§™‡§ï‡•Ä ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡•ç‡§Æ ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü' : 'Your Personalized Career Karma Report'), 20, yPosition);
      
      yPosition += 10;
      doc.setFontSize(12);
      doc.setTextColor(100, 100, 100);
      doc.text(language === 'hi' ? '‡§Ü‡§Ø‡•Å ‡§è‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ¬∑ ‡§ú‡•ç‡§Ø‡•ã‡§§‡§ø‡§∑ + NLP + ‡§ú‡•á‡§Æ‡§ø‡§®‡•Ä AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§' : 'Generated by Ayu Astro ¬∑ Powered by Jyotish + NLP + Gemini AI', 20, yPosition);
      
      yPosition += 15;
      doc.setDrawColor(...primaryColor);
      doc.line(20, yPosition, 190, yPosition);
      yPosition += 15;
      
      // Section 1: Career Signature
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '1. ‡§Ü‡§™‡§ï‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§π‡§∏‡•ç‡§§‡§æ‡§ï‡•ç‡§∑‡§∞' : '1. Your Karmic Career Signature', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const signatureData = [
        [language === 'hi' ? '‡§≤‡§ó‡•ç‡§®' : 'Lagna', 'Capricorn ‚Äì ' + (language === 'hi' ? '‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§§‡§æ' : 'The Builder')],
        [language === 'hi' ? '‡§ö‡§Ç‡§¶‡•ç‡§∞ ‡§®‡§ï‡•ç‡§∑‡§§‡•ç‡§∞' : 'Moon Nakshatra', 'Magha ‚Äì ' + (language === 'hi' ? '‡§µ‡§ø‡§∞‡§æ‡§∏‡§§ ‡§ö‡§æ‡§π‡§§‡§æ ‡§π‡•à' : 'Seeks legacy')],
        [language === 'hi' ? '10‡§µ‡•á‡§Ç ‡§ò‡§∞ ‡§ï‡§æ ‡§ó‡•ç‡§∞‡§π' : '10th House Planet', 'Mars ‚Äì ' + (language === 'hi' ? '‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ‡§®‡•ç‡§µ‡§Ø‡§®, ‡§™‡•ç‡§∞‡•á‡§∞‡§£‡§æ' : 'Execution, drive')],
        [language === 'hi' ? 'D10 ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂' : 'D10 Summary', 'Saturn ‚Äì ' + (language === 'hi' ? '‡§∏‡§Ç‡§∞‡§ö‡§®‡§æ, ‡§ß‡•Ä‡§Æ‡•Ä ‡§â‡§®‡•ç‡§®‡§§‡§ø' : 'Structure, slow rise')]
      ];
      
      signatureData.forEach(([key, value]) => {
        doc.text(`${key}: ${value}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 2: Career Blocks
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '2. ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§ï‡§∞‡•ç‡§Æ ‡§¨‡§æ‡§ß‡§æ‡§è‡§Ç' : '2. Career Karma Blocks', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const blocks = [
        'Saturn‚ÄìMoon Dasha ‚Üí ' + (language === 'hi' ? '‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§¶‡§Æ‡§® + ‡§µ‡§ø‡§≤‡§Ç‡§¨‡§ø‡§§ ‡§™‡•Å‡§∞‡§∏‡•ç‡§ï‡§æ‡§∞' : 'Emotional suppression + delayed rewards'),
        '10th Lord in 8th ‚Üí ' + (language === 'hi' ? '‡§õ‡•Å‡§™‡•á ‡§π‡•Å‡§è ‡§∂‡§ï‡•ç‡§§‡§ø ‡§∏‡§Ç‡§ò‡§∞‡•ç‡§∑' : 'Hidden power struggles'),
        'Rahu in 6th ‚Üí ' + (language === 'hi' ? '‡§Ö‡§ß‡§ø‡§ï ‡§ï‡§æ‡§Æ ‡§ï‡§æ ‡§ö‡§ï‡•ç‡§∞ + ‡§Ö‡§ß‡§ø‡§ï‡§æ‡§∞ ‡§™‡•ç‡§∞‡§§‡§ø‡§∞‡•ã‡§ß' : 'Overwork loop + authority resistance')
      ];
      
      blocks.forEach(block => {
        doc.text(`‚Ä¢ ${block}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 3: Ideal Career Roles
      if (yPosition > 250) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '3. ‡§Ü‡§¶‡§∞‡•ç‡§∂ ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§™‡§•' : '3. Ideal Career Path', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const careers = [
        [language === 'hi' ? '‡§™‡•ç‡§∞‡•ã‡§°‡§ï‡•ç‡§ü ‡§Æ‡•à‡§®‡•á‡§ú‡§∞' : 'Product Manager', language === 'hi' ? '‡§â‡§™‡§Ø‡•ã‡§ó‡§ï‡§∞‡•ç‡§§‡§æ ‡§ï‡•á‡§Ç‡§¶‡•ç‡§∞‡§ø‡§§ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§¨‡§®‡§æ‡§®‡§æ' : 'Build systems with user focus'],
        [language === 'hi' ? '‡§®‡•Ä‡§§‡§ø ‡§°‡§ø‡§ú‡§æ‡§á‡§®‡§∞' : 'Policy Designer', language === 'hi' ? '‡§∞‡§£‡§®‡•Ä‡§§‡§ø‡§ï ‡§ß‡§∞‡•ç‡§Æ-‡§∏‡§Ç‡§∞‡•á‡§ñ‡§ø‡§§ ‡§ï‡§∞‡§ø‡§Ø‡§∞' : 'Strategic dharma-aligned career'],
        [language === 'hi' ? 'UX ‡§Ü‡§∞‡•ç‡§ï‡§ø‡§ü‡•á‡§ï‡•ç‡§ü' : 'UX Architect', language === 'hi' ? '‡§Æ‡§®-‡§Ö‡§®‡•Å‡§ï‡•Ç‡§≤ ‡§∏‡§ø‡§∏‡•ç‡§ü‡§Æ ‡§°‡§ø‡§ú‡§æ‡§á‡§®' : 'Design mind-friendly systems']
      ];
      
      careers.forEach(([role, why]) => {
        doc.text(`‚Ä¢ ${role}: ${why}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 4: Timeline
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '4. ‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§∞‡§ø‡§Ø‡§∞ ‡§∏‡§Æ‡§Ø‡§∞‡•á‡§ñ‡§æ' : '4. Your Career Timeline', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      doc.text('2025-2026: Saturn Phase - ' + (language === 'hi' ? '‡§®‡§ø‡§∞‡•ç‡§Æ‡§æ‡§£ + ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ' : 'Build + Wait'), 25, yPosition);
      yPosition += 6;
      doc.text('2026-2028: Mercury Phase - ' + (language === 'hi' ? '‡§∞‡§£‡§®‡•Ä‡§§‡§ø‡§ï ‡§õ‡§≤‡§æ‡§Ç‡§ó' : 'Strategic Leap'), 25, yPosition);
      yPosition += 6;
      doc.text('2028+: ' + (language === 'hi' ? '‡§®‡§Ø‡§æ ‡§ö‡§∞‡§£' : 'New Phase'), 25, yPosition);
      yPosition += 15;
      
      // Section 5: Weekly Actions
      if (yPosition > 230) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '5. ‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï ‡§ï‡§∞‡•ç‡§Æ ‡§ï‡§æ‡§∞‡•ç‡§Ø' : '5. Weekly Karma Actions', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const weeklyActions = [
        language === 'hi' ? '‡§∏‡§™‡•ç‡§§‡§æ‡§π 1: ‡§è‡§ï ‡§Æ‡§ú‡§¶‡•Ç‡§∞ ‡§Ø‡§æ ‡§°‡•ç‡§∞‡§æ‡§á‡§µ‡§∞ ‡§ï‡•Ä ‡§¨‡§ø‡§®‡§æ ‡§Ö‡§™‡•á‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡•á‡§Ç (‡§∂‡§®‡§ø)' : 'Week 1: Help a laborer or driver without expecting anything (Saturn)',
        language === 'hi' ? '‡§∏‡§™‡•ç‡§§‡§æ‡§π 2: ‡§Ö‡§™‡§®‡•á ‡§∏‡§¨‡§∏‡•á ‡§¨‡§°‡§º‡•á ‡§≠‡§æ‡§µ‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§ò‡§æ‡§µ ‡§ï‡•ã ‡§°‡§æ‡§Ø‡§∞‡•Ä ‡§Æ‡•á‡§Ç ‡§≤‡§ø‡§ñ‡•á‡§Ç (‡§ö‡§Ç‡§¶‡•ç‡§∞)' : 'Week 2: Journal your biggest emotional wound (Moon)',
        language === 'hi' ? '‡§∏‡§™‡•ç‡§§‡§æ‡§π 3: ‡§ï‡§ø‡§∏‡•Ä ‡§ï‡•ã ‡§Ö‡§™‡§®‡§æ ‡§Æ‡§π‡§æ‡§∞‡§§ ‡§π‡§æ‡§∏‡§ø‡§≤ ‡§ï‡•å‡§∂‡§≤ ‡§∏‡§ø‡§ñ‡§æ‡§è‡§Ç (‡§¨‡•É‡§π‡§∏‡•ç‡§™‡§§‡§ø)' : 'Week 3: Teach someone a skill you have mastered (Jupiter)',
        language === 'hi' ? '‡§∏‡§™‡•ç‡§§‡§æ‡§π 4: ‡§ó‡§™‡§∂‡§™ ‡§Ø‡§æ ‡§ë‡§´‡§ø‡§∏ ‡§∞‡§æ‡§ú‡§®‡•Ä‡§§‡§ø ‡§∏‡•á ‡§¨‡§ö‡•á‡§Ç (‡§∞‡§æ‡§π‡•Å)' : 'Week 4: Avoid gossip or office politics (Rahu)'
      ];
      
      weeklyActions.forEach(action => {
        doc.text(`‚Ä¢ ${action}`, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 10;
      
      // Section 6: Remedies
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '6. ‡§ï‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§â‡§™‡§ö‡§æ‡§∞' : '6. Karmic Remedies', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(10);
      doc.setTextColor(...textColor);
      
      const remedies = [
        language === 'hi' ? 'ü™î ‡§∂‡§®‡§ø: ‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï ‡§¨‡•Å‡§ú‡•Å‡§∞‡•ç‡§ó ‡§Æ‡§ú‡§¶‡•Ç‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§ï‡§∞‡•á‡§Ç, ‡§ï‡§æ‡§≤‡§æ ‡§§‡§ø‡§≤ ‡§¶‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç' : 'ü™î Saturn: Serve elder laborers weekly, donate black sesame',
        language === 'hi' ? 'ü™î ‡§∞‡§æ‡§π‡•Å: ‡§∞‡•ã‡§ú 5 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ‡§Ç‡§∏ ‡§™‡§∞ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§Ç, ‡§Ö‡§Æ‡§æ‡§µ‡§∏‡•ç‡§Ø‡§æ ‡§™‡§∞ ‡§°‡§ø‡§ü‡•â‡§ï‡•ç‡§∏ ‡§ï‡§∞‡•á‡§Ç' : 'ü™î Rahu: Do 5 minutes of breath focus daily, detox on new moon',
        language === 'hi' ? 'ü™î ‡§ö‡§Ç‡§¶‡•ç‡§∞: ‡§™‡•Ç‡§∞‡•ç‡§£‡§ø‡§Æ‡§æ ‡§ú‡§≤ ‡§ö‡§ø‡§ï‡§ø‡§§‡•ç‡§∏‡§æ, ‡§ö‡§æ‡§Ç‡§¶‡•Ä ‡§™‡§π‡§®‡•á‡§Ç, ‡§∏‡§ö ‡§¨‡•ã‡§≤‡•á‡§Ç' : 'ü™î Moon: Full moon water therapy, wear silver, speak your truth'
      ];
      
      remedies.forEach(remedy => {
        doc.text(remedy, 25, yPosition);
        yPosition += 6;
      });
      
      yPosition += 15;
      
      // Coach Message
      if (yPosition > 220) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(16);
      doc.setTextColor(...primaryColor);
      doc.text(language === 'hi' ? '7. ‡§Ü‡§™‡§ï‡•á ‡§ï‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§ï‡•ã‡§ö ‡§ï‡§æ ‡§∏‡§Ç‡§¶‡•á‡§∂' : '7. Message from Your Karmic Coach', 20, yPosition);
      yPosition += 10;
      
      doc.setFontSize(12);
      doc.setTextColor(...textColor);
      const coachMessage = language === 'hi' ? 
        '‡§Ü‡§™ ‡§ñ‡•ã‡§è ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§Ü‡§™ ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§ï‡§∞‡•ç‡§Æ ‡§î‡§∞ ‡§®‡§è ‡§ß‡§∞‡•ç‡§Æ ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§µ‡§ø‡§∞‡§æ‡§Æ ‡§Æ‡•á‡§Ç ‡§π‡•à‡§Ç‡•§ ‡§á‡§∏‡•á ‡§Ü‡§™‡§ï‡•ã ‡§∏‡§ø‡§ñ‡§æ‡§®‡•á ‡§¶‡•á‡§Ç ‚Äî ‡§™‡§∞‡§ø‡§≠‡§æ‡§∑‡§ø‡§§ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§®‡•á ‡§¶‡•á‡§Ç‡•§' :
        'You\'re not lost. You\'re in the pause between past karma and new dharma. Let it teach you ‚Äî not define you.';
      
      const splitMessage = doc.splitTextToSize(`"${coachMessage}"`, 150);
      doc.text(splitMessage, 25, yPosition);
      yPosition += splitMessage.length * 6 + 15;
      
      // Footer
      if (yPosition > 250) {
        doc.addPage();
        yPosition = 20;
      }
      
      doc.setFontSize(10);
      doc.setTextColor(100, 100, 100);
      doc.text(language === 'hi' ? '‡§Ü‡§Ø‡•Å ‡§è‡§∏‡•ç‡§ü‡•ç‡§∞‡•ã ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§â‡§§‡•ç‡§™‡§®‡•ç‡§® ¬∑ ‡§∏‡•ç‡§µ‡§ø‡§∏ ‡§è‡§´‡•á‡§Æ‡•á‡§∞‡§ø‡§∏ + ‡§ú‡•á‡§Æ‡§ø‡§®‡•Ä AI ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ ‡§∏‡§Ç‡§ö‡§æ‡§≤‡§ø‡§§' : 'Generated by Ayu Astro ¬∑ Powered by Swiss Ephemeris + Gemini AI', 20, yPosition);
      yPosition += 6;
      doc.text(language === 'hi' ? '‡§Ü‡§™‡§ï‡§æ ‡§ï‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§™‡§• ‡§™‡§µ‡§ø‡§§‡•ç‡§∞ ‡§π‡•à‡•§ ‡§á‡§∏‡•á ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§¶‡•á‡§Ç, ‡§™‡•ç‡§∞‡§§‡§ø‡§¨‡§Ç‡§ß‡§ø‡§§ ‡§® ‡§ï‡§∞‡•á‡§Ç‡•§' : 'Your karmic path is sacred. Let it guide, not restrict you.', 20, yPosition);
      
      // Save the PDF
      const fileName = `karmic-career-report-${new Date().toISOString().split('T')[0]}.pdf`;
      doc.save(fileName);
      
      toast({
        title: language === 'hi' ? "PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§Ø‡§æ" : "PDF Downloaded",
        description: language === 'hi' ? "‡§Ü‡§™‡§ï‡•Ä ‡§ï‡§∞‡•ç‡§Æ‡§ø‡§ï ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à" : "Your karmic report has been downloaded successfully"
      });
      
    } catch (error) {
      console.error('Error generating PDF:', error);
      toast({
        title: language === 'hi' ? "‡§§‡•ç‡§∞‡•Å‡§ü‡§ø" : "Error",
        description: language === 'hi' ? "PDF ‡§¨‡§®‡§æ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø ‡§π‡•Å‡§à" : "Error generating PDF",
        variant: "destructive"
      });
    }
  };

  return (
    <Button onClick={generatePDF} className="w-full sm:w-auto bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white">
      <Download className="w-4 h-4 mr-2" />
      {language === 'hi' ? 'üì• PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç' : 'üì• Download PDF'}
    </Button>
  );
};

export default KarmicReportPDFExport;
